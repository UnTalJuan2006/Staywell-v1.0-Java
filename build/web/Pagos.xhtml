<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<h:head>
    <title>Pago de Reserva</title>
    <style>
        body {
            background-color: #f7f7f7;
            font-family: 'Segoe UI', sans-serif;
        }
        .card {
            max-width: 600px;
            margin: 3rem auto;
            padding: 2rem;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .label {
            font-weight: bold;
            color: #333;
        }
    </style>
</h:head>
<h:body>

    <!-- Growl global fuera del formulario -->
    <p:growl id="growl" showDetail="true" life="4500" />

    <!-- Formulario principal de pago -->
    <h:form id="formPago" class="card">
        <h2 style="text-align:center;">Confirmar Pago</h2>

        <h:panelGrid columns="2" columnClasses="label,value" cellpadding="6" style="width:100%;">

            <h:outputLabel value="Reserva:" />
            <h:outputText value="#{pagoBean.reserva != null ? pagoBean.reserva.idReserva : 'No encontrada'}" />

            <!-- Tipo de tarjeta -->
            <h:outputLabel value="Tipo de Tarjeta:" for="tipo" />
            <p:selectOneMenu id="tipo" value="#{pagoBean.pago.tipoTarjeta}" style="width:100%"
                             required="true" requiredMessage="Seleccione un tipo de tarjeta">
                <f:selectItem itemLabel="Seleccione..." itemValue="#{null}" noSelectionOption="true" />
                <f:selectItems value="#{pagoBean.tiposTarjeta}" var="t" itemLabel="#{t}" itemValue="#{t}" />
                <p:ajax update="cuotasPanel" />
            </p:selectOneMenu>

            <!-- Número de tarjeta -->
            <h:outputLabel value="Número de Tarjeta:" for="num" />
            <p:inputText id="num" value="#{pagoBean.pago.numeroTarjeta}" maxlength="19"
                         required="true" label="Número de Tarjeta">
                <f:validateRegex pattern="\d{13,19}" />
                <p:ajax event="blur" update=":growl" />
            </p:inputText>

            <!-- Titular -->
            <h:outputLabel value="Titular:" for="titular" />
            <p:inputText id="titular" value="#{pagoBean.pago.titular}" required="true">
                <f:validateRegex pattern="[A-Za-zÁÉÍÓÚáéíóúÑñ ]{3,60}" />
                <p:ajax event="blur" update=":growl" />
            </p:inputText>



            <!-- Código de seguridad -->
            <h:outputLabel value="Código de Seguridad:" for="cvv" />
            <p:password id="cvv" value="#{pagoBean.pago.codigoSeguridad}" maxlength="4" required="true">
                <f:validateRegex pattern="\d{3,4}" />
                <p:ajax event="blur" update=":growl" />
            </p:password>

            <!-- Monto -->

        </h:panelGrid>

        <!-- Panel dinámico para cuotas -->
        <p:outputPanel id="cuotasPanel" style="margin-top:1rem;">
            <h:panelGrid columns="2" columnClasses="label,value" rendered="#{pagoBean.creditoSeleccionado}">
                <h:outputLabel value="Número de Cuotas:" for="cuotas" />
                <p:inputText id="cuotas" value="#{pagoBean.cuotas}" maxlength="2"
                             placeholder="Ej: 12" />
            </h:panelGrid>
        </p:outputPanel>

        <!-- Botones -->
        <div style="margin-top:2rem; text-align:center;">
            <p:commandButton value="Confirmar Pago"
                             actionListener="#{pagoBean.registrarPago}"
                             update="@form :growl pagoExitoDialog"
                             icon="pi pi-check"
                             styleClass="p-button-success"
                             oncomplete="if(args &amp;&amp; args.pagoExitoso){PF('pagoExitoDialog').show();}" />
            <p:commandButton value="Cancelar" type="reset"
                             icon="pi pi-times"
                             styleClass="p-button-secondary" />
        </div>

        <p:dialog id="pagoExitoDialog" widgetVar="pagoExitoDialog" modal="true" closable="false"
                  rendered="#{pagoBean.pagoExitoso}" showEffect="fade" hideEffect="fade"
                  styleClass="pago-exito-dialog">
            <h3 style="text-align:center; margin-bottom:1rem; color:#1a9b8e;">
                <i class="pi pi-check-circle" style="font-size:2rem; margin-right:.5rem;"></i>
                ¡Pago confirmado!
            </h3>
            <p style="text-align:center; font-size:1.1rem;">
                #{pagoBean.mensajeExito}
            </p>
            <p style="text-align:center; color:#6c757d; margin-top:.5rem;">
                Código de pago: <strong>#{pagoBean.codigoPagoGenerado}</strong>
            </p>
            <div style="display:flex; justify-content:center; gap:1rem; margin-top:2rem;">
                <p:commandButton value="Ver mis reservas" action="#{pagoBean.irMisReservas}"
                                 icon="pi pi-arrow-right" ajax="false"
                                 styleClass="p-button-rounded p-button-success" />
                <p:commandButton type="button" value="Cerrar" icon="pi pi-times" onclick="PF('pagoExitoDialog').hide();"
                                 styleClass="p-button-rounded p-button-secondary" />
            </div>
        </p:dialog>

    </h:form>
</h:body>
</html>
